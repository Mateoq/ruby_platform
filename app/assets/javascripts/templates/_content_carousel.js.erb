prTemplates.directive('contentCarousel', ['$timeout', function ($timeout) {
	return {
		templateUrl: '_content_carousel.html',
		transclude: true,
		restrict: 'E',
		scope: {
			carouselItems: '=carouselItems'
		},
		link: function (scope, element, attrs, ctrl, transclude) {
			scope.itemPosition = 0;

			$timeout(function () {
				angular.element('#pr_partial_carousel').height(angular.element('.pr-lesson-content').height());
				// var $mainContent = angular.element('.ccar-item');

				// $newScope = scope.$parent.$parent;

	   //          transclude(scope.$parent.$parent, function(clone, scope) {
	   //          	console.log(clone);
				// 	$mainContent.empty();
				// 	$mainContent.append(clone);
				// });

				angular.element('#pr_partial_carousel').carousel({
					interval: false,
					wrap: false
				});

				var $carouselControl = angular.element('.ccar-control');

				$carouselControl.on('click', function(event) {
					var $self = angular.element(this);
					$self.addClass('rubberBand');
					setTimeout(function () {
						$self.removeClass('rubberBand');
					}, 700);
				});

				scope.numItems = angular.element('.ccar-item').length - 1;

				angular.element('.ccar-control.left').fadeOut();

				if (1 === angular.element('.ccar-item').length) $carouselControl.hide();
			});

			scope.carouselNext = function ($event) {
				if (scope.itemsPosition === scope.numItems) { return; }
				scope.itemPosition++;
				
				var $target = angular.element($event.currentTarget),
					$sibling = angular.element('.ccar-control.left');

				if (scope.itemPosition === scope.numItems)
					// $target.addClass('fadeOut');
					$target.fadeOut(600);
				else
					// $target.removeClass('fadeOut').addClass('fadeIn');
					$target.fadeIn(600);

				if (scope.itemPosition > 0)
					// $sibling.removeClass('fadeOut').addClass('fadeIn');
					$sibling.fadeIn(600);
			}

			scope.carouselPrev = function ($event) {
				if (0 === scope.itemsPosition) { return; }
				scope.itemPosition--;

				var $target = angular.element($event.currentTarget),
					$sibling = angular.element('.ccar-control.right');;

				if (scope.itemPosition === 0)
					// $target.addClass('fadeOut');
					$target.fadeOut(600);
				else
					// $target.removeClass('fadeOut').addClass('fadeIn');
					$target.fadeIn(600);

				if (scope.itemPosition != scope.numItems)
					// $sibling.removeClass('fadeOut').addClass('fadeIn');
					$sibling.fadeIn(600);
			}
		}
	};
}]);