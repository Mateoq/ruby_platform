prTemplates.directive('tableForm', ['$sce', '$window', '$document', '$timeout', 'formValidation', function ($sce, $window, $document, $timeout, formValidation) {
	return {
		templateUrl: 'table_form.html',
		restrict: 'E',
		scope: {
			options: '=options'
		},
		link: function (scope, element, attrs, ngModel) {
			scope.options.templateClass = 'table-form';

			formValidation.initialize(scope.options.pattern);

			for (var i = 0; i < scope.options.tableItems.length; i++) {
				for (var j = 0; j < scope.options.tableItems[i].length; j++) {
					if (scope.options.tableItems[i][j].hasOwnProperty('text')) continue;

					scope.options.tableItems[i][j].chances = 2;	
				}
			}

			scope.validate = formValidation.validate;
		}
	};
}]);